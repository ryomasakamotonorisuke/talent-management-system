"use strict";(()=>{var e={};e.id=41,e.ids=[41],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3858:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>I,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var r={};a.r(r),a.d(r,{GET:()=>c});var n=a(9303),s=a(8716),o=a(670),i=a(7070),u=a(1926);async function c(e){try{let{count:e=0,error:t}=await u.OQ.from("trainees").select("*",{count:"exact",head:!0}).eq("is_active",!0);if(t)throw t;let{data:a,error:r}=await u.OQ.from("trainees").select("nationality").eq("is_active",!0);if(r)throw r;let n=new Map;(a??[]).forEach(e=>{let t=e.nationality;t&&n.set(t,(n.get(t)??0)+1)});let s=Array.from(n.entries()).map(([e,t])=>({nationality:e,_count:{nationality:t}})).sort((e,t)=>t._count.nationality-e._count.nationality),{data:o,error:c}=await u.OQ.from("trainees").select("department").eq("is_active",!0);if(c)throw c;let p=new Map;(o??[]).forEach(e=>{let t=e.department;t&&p.set(t,(p.get(t)??0)+1)});let l=Array.from(p.entries()).map(([e,t])=>({department:e,_count:{department:t}})).sort((e,t)=>t._count.department-e._count.department),d=new Date;d.setMonth(d.getMonth()-3);let{count:h=0,error:m}=await u.OQ.from("trainees").select("*",{count:"exact",head:!0}).eq("is_active",!0).gte("entry_date",d.toISOString());if(m)throw m;let I=new Date(Date.now()-7776e6).toISOString(),{data:f,error:y}=await u.OQ.from("evaluations").select("level, evaluation_date").gte("evaluation_date",I);if(y)throw y;let b=(f??[]).map(e=>e.level).filter(e=>"number"==typeof e),w=b.length>0?b.reduce((e,t)=>e+t,0)/b.length:0;return i.NextResponse.json({totalTrainees:e,newTrainees:h,averageSkillLevel:Math.round(100*w)/100,nationalityStats:s.map(e=>({nationality:e.nationality,count:e._count.nationality})),departmentStats:l.map(e=>({department:e.department,count:e._count.department}))})}catch(e){return console.error("統計データ取得エラー:",e),i.NextResponse.json({error:"統計データの取得に失敗しました"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:"app/api/dashboard/stats/route"},resolvedPagePath:"C:\\Users\\ngf005148\\Desktop\\webapps\\talent\\src\\app\\api\\dashboard\\stats\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:h}=p,m="/api/dashboard/stats/route";function I(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},1926:(e,t,a)=>{a.d(t,{OQ:()=>n,a5:()=>o,pR:()=>s});var r=a(2885);let n=(0,r.createClient)("https://mvycskeubwvyodmpdfbv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12eWNza2V1Ynd2eW9kbXBkZmJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2ODI1MjIsImV4cCI6MjA3NzI1ODUyMn0.e2QeNpwpfG8QC13u1ozU21oyqT--VAXTZzlPwNshSTw",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"X-Client-Info":"supabase-js-web"}}}),s=(0,r.createClient)("https://mvycskeubwvyodmpdfbv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12eWNza2V1Ynd2eW9kbXBkZmJ2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTY4MjUyMiwiZXhwIjoyMDc3MjU4NTIyfQ.bUwrCEChvxrZ1Sz4KbM30uZ3fxHy7tZzcwZKuTUAu0w",{auth:{autoRefreshToken:!1,persistSession:!1},global:{headers:{"X-Client-Info":"supabase-js-server"}}}),o=async()=>{try{let{data:{session:e},error:t}=await n.auth.getSession();if(t)return console.error("Supabase auth error:",t),!1;return console.log("Supabase connection successful (auth test)"),!0}catch(e){return console.error("Supabase connection test failed:",e),!1}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(3858));module.exports=r})();