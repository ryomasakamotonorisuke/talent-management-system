(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6499:function(e,s,t){Promise.resolve().then(t.bind(t,441))},441:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var a=t(7437),i=t(2265),l=t(6850);function n(){let{user:e,loading:s}=(0,l.a)(),[t,n]=(0,i.useState)([]),[r,c]=(0,i.useState)({totalTrainees:0,nationalityStats:[]}),[d,x]=(0,i.useState)(!0);(0,i.useEffect)(()=>{e&&m()},[e]);let m=async()=>{try{let e=await fetch("/api/supabase?action=get-trainees"),s=await e.json();n(s.trainees||[]);let t=await fetch("/api/supabase?action=get-stats"),a=await t.json();c(a)}catch(e){console.error("データ取得エラー:",e)}finally{x(!1)}};return s||d?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ダッシュボード"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:["Supabase認証でログイン中: ",e.email]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-8 w-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-blue-600 font-bold",children:"\uD83D\uDC65"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"実習生総数"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.totalTrainees})]})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-8 w-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-green-600 font-bold",children:"\uD83C\uDF0D"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"国籍数"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.nationalityStats.length})]})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-8 w-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-purple-600 font-bold",children:"\uD83C\uDFE2"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"部署数"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:new Set(t.map(e=>e.department)).size})]})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-8 w-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-yellow-600 font-bold",children:"\uD83D\uDCCA"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"データ更新"}),(0,a.jsx)("p",{className:"text-sm font-bold text-gray-900",children:"リアルタイム"})]})]})})]}),r.nationalityStats.length>0&&(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"国籍別統計"}),(0,a.jsx)("div",{className:"space-y-3",children:r.nationalityStats.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:e.nationality}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2 mr-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.count/r.totalTrainees*100,"%")}})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.count})]})]},e.nationality))})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"実習生一覧"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"実習生ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"氏名"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"国籍"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"部署"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"在留期限"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.trainee_id}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.last_name," ",e.first_name]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.nationality}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.department}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.visa_expiry_date).toLocaleDateString("ja-JP")})]},e.id))})]})})]})]}):(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-red-600",children:"ログインが必要です"})})}},6850:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return d},a:function(){return x}});var a=t(7437),i=t(2265),l=t(1545);let n=(0,l.eI)("https://mvycskeubwvyodmpdfbv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12eWNza2V1Ynd2eW9kbXBkZmJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2ODI1MjIsImV4cCI6MjA3NzI1ODUyMn0.e2QeNpwpfG8QC13u1ozU21oyqT--VAXTZzlPwNshSTw",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"X-Client-Info":"supabase-js-web"}}});(0,l.eI)("https://mvycskeubwvyodmpdfbv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12eWNza2V1Ynd2eW9kbXBkZmJ2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTY4MjUyMiwiZXhwIjoyMDc3MjU4NTIyfQ.bUwrCEChvxrZ1Sz4KbM30uZ3fxHy7tZzcwZKuTUAu0w",{auth:{autoRefreshToken:!1,persistSession:!1},global:{headers:{"X-Client-Info":"supabase-js-server"}}});var r=t(9376);let c=(0,i.createContext)(void 0),d=e=>{let{children:s}=e,[t,l]=(0,i.useState)(null),[d,x]=(0,i.useState)(null),[m,h]=(0,i.useState)(!0),u=(0,r.useRouter)();(0,i.useEffect)(()=>{(async()=>{let{data:{session:e},error:s}=await n.auth.getSession();if(s)console.error("セッション取得エラー:",s);else{var t;x(e),l(null!==(t=null==e?void 0:e.user)&&void 0!==t?t:null)}h(!1)})();let{data:{subscription:e}}=n.auth.onAuthStateChange(async(e,s)=>{var t;x(s),l(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),h(!1),"SIGNED_IN"===e?u.push("/dashboard"):"SIGNED_OUT"===e&&u.push("/login")});return()=>e.unsubscribe()},[u]);let o=async(e,s)=>{let{error:t}=await n.auth.signInWithPassword({email:e,password:s});return{error:t}},p=async()=>{await n.auth.signOut()},j=async(e,s,t)=>{let{error:a}=await n.auth.signUp({email:e,password:s,options:{data:t}});return{error:a}};return(0,a.jsx)(c.Provider,{value:{user:t,session:d,loading:m,signIn:o,signOut:p,signUp:j},children:s})},x=()=>{let e=(0,i.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[256,971,117,744],function(){return e(e.s=6499)}),_N_E=e.O()}]);